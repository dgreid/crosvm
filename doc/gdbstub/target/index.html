<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The core [`Target`] trait, and all its various protocol extension traits."><meta name="keywords" content="rust, rustlang, rust-lang, target"><title>gdbstub::target - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../gdbstub/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module target</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="target" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">gdbstub</a>::<wbr><a class="mod" href="#">target</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/gdbstub/target/mod.rs.html#1-396" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The core <a href="trait.Target.html" title="Target"><code>Target</code></a> trait, and all its various protocol extension traits.</p>
<p>The <a href="trait.Target.html" title="Target"><code>Target</code></a> trait describes how to control and modify a system’s
execution state during a GDB debugging session, and serves as the
primary bridge between <code>gdbstub</code>’s generic protocol implementation and a
target’s project/platform-specific code.</p>
<p><strong><code>Target</code> is the most important trait in <code>gdbstub</code>, and must be implemented
by all consumers of the library!</strong></p>
<h1 id="implementing-target" class="section-header"><a href="#implementing-target">Implementing <code>Target</code></a></h1>
<p><code>gdbstub</code> uses a technique called <a href="ext/index.html">“Inlineable Dyn Extension Traits”</a>
(IDETs) to expose an ergonomic and extensible interface to the GDB protocol.
It’s not a very common pattern, and can seem a little “weird” at first
glance, but IDETs are actually very straightforward to use!</p>
<p><strong>TL;DR:</strong> Whenever you see a method that returns something that looks like
<code>Option&lt;ProtocolExtOps&gt;</code>, you can enable that protocol extension by
implementing the <code>ProtocolExt</code> type on your target, and overriding the
<code>Option&lt;ProtocolExtOps&gt;</code> method to return <code>Some(self)</code>.</p>
<p>Please refer to the <a href="ext/index.html">documentation in the <code>ext</code> module</a> for more
information on IDETs, including a more in-depth explanation of how they
work, and how <code>Target</code> leverages them to provide fine grained control over
enabled protocol features.</p>
<h2 id="associated-types-1" class="section-header"><a href="#associated-types-1">Associated Types</a></h2>
<ul>
<li>
<p>The <a href="trait.Target.html#associatedtype.Arch"><code>Target::Arch</code></a> associated
type encodes information about the target’s architecture, such as its
pointer size, register layout, etc… <code>gdbstub</code> comes with several
built-in architecture definitions, which can be found under the
<a href="../arch/index.html"><code>arch</code></a> module.</p>
</li>
<li>
<p>The <a href="trait.Target.html#associatedtype.Error"><code>Target::Error</code></a> associated
type allows implementors to plumb-through their own project-specific fatal
error type into the <code>Target</code> trait. This is a big-boost to library
ergonomics, as it enables consumers of <code>gdbstub</code> to preserve
target-specific context while using <code>gdbstub</code>, without having to do any
“error-stashing”.</p>
</li>
</ul>
<p>For example: consider an emulated target where certain devices might return
a <code>MyEmuError::ContractViolation</code> error whenever they’re accessed
“improperly” (e.g: setting registers in the wrong order). By setting <code>type Error = MyEmuError</code>, the method signature of the <code>Target</code>’s <code>resume</code> method
becomes <code>fn resume(&amp;mut self, ...) -&gt; Result&lt;_, MyEmuError&gt;</code>, which makes it
possible to preserve the target-specific error while using <code>gdbstub</code>!</p>
<blockquote>
<p><em>Aside:</em> What’s with all the <code>&lt;Self::Arch as Arch&gt;::</code> syntax?</p>
</blockquote>
<blockquote>
<p>As you explore <code>Target</code> and its many extension traits, you’ll enounter
many method signatures that use this pretty gnarly bit of Rust type syntax.</p>
</blockquote>
<blockquote>
<p>If <a href="https://github.com/rust-lang/rust/issues/38078">rust-lang/rust#38078</a>
gets fixed, then types like <code>&lt;Self::Arch as Arch&gt;::Foo</code> could be simplified
to just <code>Self::Arch::Foo</code>, but until then, the much more explicit
<a href="https://doc.rust-lang.org/book/ch19-03-advanced-traits.html#fully-qualified-syntax-for-disambiguation-calling-methods-with-the-same-name">fully qualified syntax</a>
must be used instead.</p>
</blockquote>
<blockquote>
<p>To improve the readability and maintainability of your own implementation,
it’d be best to swap out the fully qualified syntax with whatever concrete
type is being used. e.g: on a 32-bit target, instead of cluttering up a
method implementation with a parameter passed as <code>(addr: &lt;Self::Arch as Arch&gt;::Usize)</code>, just write <code>(addr: u32)</code> directly.</p>
</blockquote>
<h2 id="required-methods-base-protocol" class="section-header"><a href="#required-methods-base-protocol">Required Methods (Base Protocol)</a></h2>
<p>A minimal <code>Target</code> implementation only needs to implement a single method:
<a href="trait.Target.html#tymethod.base_ops"><code>Target::base_ops</code></a>. This method is
used to select which set of <a href="ext/base/index.html"><code>base</code></a>
debugging operations will be used to control the target. These are
fundamental operations such as starting/stopping execution, reading/writing
memory, etc…</p>
<p>All other methods are entirely optional! Check out the
<a href="ext/index.html" title="ext"><code>ext</code></a> module for a full list of currently supported protocol extensions.</p>
<h3 id="example-a-bare-minimum-single-threaded-target" class="section-header"><a href="#example-a-bare-minimum-single-threaded-target">Example: A Bare-Minimum Single Threaded <code>Target</code></a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">gdbstub::target</span>::{<span class="ident">Target</span>, <span class="ident">TargetResult</span>};
<span class="kw">use</span> <span class="ident">gdbstub::target::ext::base::BaseOps</span>;
<span class="kw">use</span> <span class="ident">gdbstub::target::ext::base::singlethread::SingleThreadOps</span>;
<span class="kw">use</span> <span class="ident">gdbstub::target::ext::base::singlethread</span>::{<span class="ident">ResumeAction</span>, <span class="ident">GdbInterrupt</span>, <span class="ident">StopReason</span>};

<span class="kw">struct</span> <span class="ident">MyTarget</span>;

<span class="kw">impl</span> <span class="ident">Target</span> <span class="kw">for</span> <span class="ident">MyTarget</span> {
    <span class="kw">type</span> <span class="ident">Error</span> <span class="op">=</span> ();
    <span class="kw">type</span> <span class="ident">Arch</span> <span class="op">=</span> <span class="ident">gdbstub_arch::arm::Armv4t</span>; <span class="comment">// as an example</span>

    <span class="kw">fn</span> <span class="ident">base_ops</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">BaseOps</span><span class="op">&lt;</span><span class="ident"><span class="self">Self</span>::Arch</span>, <span class="ident"><span class="self">Self</span>::Error</span><span class="op">&gt;</span> {
        <span class="ident">BaseOps::SingleThread</span>(<span class="self">self</span>)
    }
}

<span class="kw">impl</span> <span class="ident">SingleThreadOps</span> <span class="kw">for</span> <span class="ident">MyTarget</span> {
    <span class="kw">fn</span> <span class="ident">resume</span>(
        <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>,
        <span class="ident">action</span>: <span class="ident">ResumeAction</span>,
        <span class="ident">gdb_interrupt</span>: <span class="ident">GdbInterrupt</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">StopReason</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>, ()<span class="op">&gt;</span> { <span class="macro">todo!</span>() }

    <span class="kw">fn</span> <span class="ident">read_registers</span>(
        <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>,
        <span class="ident">regs</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">gdbstub_arch::arm::reg::ArmCoreRegs</span>,
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">TargetResult</span><span class="op">&lt;</span>(), <span class="self">Self</span><span class="op">&gt;</span> { <span class="macro">todo!</span>() }

    <span class="kw">fn</span> <span class="ident">write_registers</span>(
        <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>,
        <span class="ident">regs</span>: <span class="kw-2">&amp;</span><span class="ident">gdbstub_arch::arm::reg::ArmCoreRegs</span>
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">TargetResult</span><span class="op">&lt;</span>(), <span class="self">Self</span><span class="op">&gt;</span> { <span class="macro">todo!</span>() }

    <span class="kw">fn</span> <span class="ident">read_addrs</span>(
        <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>,
        <span class="ident">start_addr</span>: <span class="ident">u32</span>,
        <span class="ident">data</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>],
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">TargetResult</span><span class="op">&lt;</span>(), <span class="self">Self</span><span class="op">&gt;</span> { <span class="macro">todo!</span>() }

    <span class="kw">fn</span> <span class="ident">write_addrs</span>(
        <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="self">self</span>,
        <span class="ident">start_addr</span>: <span class="ident">u32</span>,
        <span class="ident">data</span>: <span class="kw-2">&amp;</span>[<span class="ident">u8</span>],
    ) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">TargetResult</span><span class="op">&lt;</span>(), <span class="self">Self</span><span class="op">&gt;</span> { <span class="macro">todo!</span>() }
}</code></pre></div>
<h2 id="optional-methods-protocol-extensions" class="section-header"><a href="#optional-methods-protocol-extensions">Optional Methods (Protocol Extensions)</a></h2>
<p>The GDB protocol is <em>massive</em>, and there are plenty of optional protocol
extensions that targets can implement to enhance the base debugging
experience. These protocol extensions range from relatively mundane things
such as setting/removing breakpoints or reading/writing individual
registers, but also include fancy things such as  support for time travel
debugging, running shell commands remotely, or even performing file IO on
the target!</p>
<p>As a starting point, consider implementing some of the breakpoint related
extensions under <a href="ext/breakpoints/index.html"><code>breakpoints</code></a>. While
setting/removing breakpoints is technically an “optional” part of the GDB
protocol, I’m sure you’d be hard pressed to find a debugger that doesn’t
support breakpoints.</p>
<p>Please make sure to read and understand <a href="ext/index.html">the documentation</a> regarding
how IDETs work!</p>
<h3 id="note-missing-protocol-extensions" class="section-header"><a href="#note-missing-protocol-extensions">Note: Missing Protocol Extensions</a></h3>
<p><code>gdbstub</code>’s development is guided by the needs of its contributors, with
new features being added on an “as-needed” basis.</p>
<p>If there’s a GDB protocol extensions you’re interested in that hasn’t been
implemented in <code>gdbstub</code> yet, (e.g: remote filesystem access, tracepoint
support, etc…), consider opening an issue / filing a PR on GitHub!</p>
<p>Check out the <a href="https://sourceware.org/gdb/onlinedocs/gdb/Remote-Configuration.html">GDB Remote Configuration Docs</a>
for a table of GDB commands + their corresponding Remote Serial Protocol
packets.</p>
<h2 id="a-note-on-error-handling" class="section-header"><a href="#a-note-on-error-handling">A note on error handling</a></h2>
<p>As you explore the various protocol extension traits, you’ll often find that
functions don’t return a typical <a href="https://doc.rust-lang.org/1.56.1/core/result/enum.Result.html" title="Result&lt;T, Self::Error&gt;"><code>Result&lt;T, Self::Error&gt;</code></a>,
and will instead return a <a href="type.TargetResult.html" title="TargetResult&lt;T, Self&gt;"><code>TargetResult&lt;T, Self&gt;</code></a>.</p>
<p>At first glance, this might look a bit strange, since it might look as
though the <code>Err</code> variant of <code>TargetResult</code> is actually <code>Self</code> instead of
<code>Self::Error</code>! Thankfully, there’s a good reason for why that’s the case,
which you can read about as part of the <a href="enum.TargetError.html" title="TargetError"><code>TargetError</code></a> documentation.</p>
<p>In a nutshell, <code>TargetResult</code> wraps a typical <code>Result&lt;T, Self::Error&gt;</code> with
a few additional error types which can be reported back to the GDB client
via the GDB RSP. For example, if the GDB client tried to read memory from
invalid memory, instead of immediately terminating the entire debugging
session, it’s possible to simply return a <code>Err(TargetError::Errno(14)) // EFAULT</code>, which will notify the GDB client that the operation has failed.</p>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="mod" href="ext/index.html" title="gdbstub::target::ext mod">ext</a></div><div class="item-right docblock-short"><p>Extensions to <a href="trait.Target.html"><code>Target</code></a> which add support for various
subsets of the GDB Remote Serial Protocol.</p>
</div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="enum" href="enum.TargetError.html" title="gdbstub::target::TargetError enum">TargetError</a></div><div class="item-right docblock-short"><p>The error type for various methods on <code>Target</code> and its assorted associated
extension traits.</p>
</div></div><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="trait" href="trait.Target.html" title="gdbstub::target::Target trait">Target</a></div><div class="item-right docblock-short"><p>Describes the architecture and capabilities of a target which can be
debugged by <a href="../struct.GdbStub.html"><code>GdbStub</code></a>.</p>
</div></div><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="type" href="type.TargetResult.html" title="gdbstub::target::TargetResult type">TargetResult</a></div><div class="item-right docblock-short"><p>A specialized <code>Result</code> type for <code>Target</code> operations.</p>
</div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="gdbstub" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div>
    <script src="../../main.js"></script>
</body></html>