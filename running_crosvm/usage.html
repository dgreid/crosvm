<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Command Line Options - Book of crosvm</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../building_crosvm/index.html"><strong aria-hidden="true">2.</strong> Building Crosvm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building_crosvm/linux.html"><strong aria-hidden="true">2.1.</strong> For Linux</a></li><li class="chapter-item expanded "><a href="../building_crosvm/chromium_os.html"><strong aria-hidden="true">2.2.</strong> For Chromium OS</a></li></ol></li><li class="chapter-item expanded "><a href="../running_crosvm/index.html"><strong aria-hidden="true">3.</strong> Running Crosvm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../running_crosvm/basic_usage.html"><strong aria-hidden="true">3.1.</strong> Basic Usage</a></li><li class="chapter-item expanded "><a href="../running_crosvm/usage.html" class="active"><strong aria-hidden="true">3.2.</strong> Command Line Options</a></li><li class="chapter-item expanded "><a href="../running_crosvm/requirements.html"><strong aria-hidden="true">3.3.</strong> System Requirements</a></li><li class="chapter-item expanded "><a href="../running_crosvm/features.html"><strong aria-hidden="true">3.4.</strong> Features</a></li><li class="chapter-item expanded "><a href="../running_crosvm/devices.html"><strong aria-hidden="true">3.5.</strong> Devices</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="../contributing.html"><strong aria-hidden="true">5.</strong> Contributing</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../onboarding.html"><strong aria-hidden="true">6.</strong> Onboarding Resources</a></li><li class="chapter-item expanded "><a href="../appendix/index.html"><strong aria-hidden="true">7.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../appendix/example_usage.html"><strong aria-hidden="true">7.1.</strong> Example Usage (Outdated)</a></li><li class="chapter-item expanded "><a href="../appendix/sandboxing.html"><strong aria-hidden="true">7.2.</strong> Sandboxing</a></li><li class="chapter-item expanded "><a href="../appendix/seccomp.html"><strong aria-hidden="true">7.3.</strong> Seccomp</a></li><li class="chapter-item expanded "><a href="../appendix/minijail.html"><strong aria-hidden="true">7.4.</strong> Minijail</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../api.html">API Documentation</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Book of crosvm</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>To see the usage information for your version of crosvm, run <code>crosvm</code> or <code>crosvm run --help</code>.</p>
<h2 id="boot-a-kernel"><a class="header" href="#boot-a-kernel">Boot a Kernel</a></h2>
<p>To run a very basic VM with just a kernel and default devices:</p>
<pre><code class="language-bash">$ crosvm run &quot;${KERNEL_PATH}&quot;
</code></pre>
<p>The uncompressed kernel image, also known as vmlinux, can be found in your
kernel build directory in the case of x86 at <code>arch/x86/boot/compressed/vmlinux</code>.</p>
<h2 id="rootfs"><a class="header" href="#rootfs">Rootfs</a></h2>
<h3 id="with-a-disk-image"><a class="header" href="#with-a-disk-image">With a disk image</a></h3>
<p>In most cases, you will want to give the VM a virtual block device to use as a
root file system:</p>
<pre><code class="language-bash">$ crosvm run -r &quot;${ROOT_IMAGE}&quot; &quot;${KERNEL_PATH}&quot;
</code></pre>
<p>The root image must be a path to a disk image formatted in a way that the kernel
can read. Typically this is a squashfs image made with <code>mksquashfs</code> or an ext4
image made with <code>mkfs.ext4</code>. By using the <code>-r</code> argument, the kernel is
automatically told to use that image as the root, and therefore can only be
given once. More disks can be given with <code>-d</code> or <code>--rwdisk</code> if a writable disk
is desired.</p>
<p>To run crosvm with a writable rootfs:</p>
<blockquote>
<p><strong>WARNING:</strong> Writable disks are at risk of corruption by a malicious or
malfunctioning guest OS.</p>
</blockquote>
<pre><code class="language-bash">crosvm run --rwdisk &quot;${ROOT_IMAGE}&quot; -p &quot;root=/dev/vda&quot; vmlinux
</code></pre>
<blockquote>
<p><strong>NOTE:</strong> If more disks arguments are added prior to the desired rootfs image,
the <code>root=/dev/vda</code> must be adjusted to the appropriate letter.</p>
</blockquote>
<h3 id="with-virtiofs"><a class="header" href="#with-virtiofs">With virtiofs</a></h3>
<p>Linux kernel 5.4+ is required for using virtiofs. This is convenient for
testing. The file system must be named &quot;mtd*&quot; or &quot;ubi*&quot;.</p>
<pre><code class="language-bash">crosvm run --shared-dir &quot;/:mtdfake:type=fs:cache=always&quot; \
    -p &quot;rootfstype=virtiofs root=mtdfake&quot; vmlinux
</code></pre>
<h2 id="network-device"><a class="header" href="#network-device">Network device</a></h2>
<p>The most convenient way to provide a network device to a guest is to setup a persistent TAP
interface on the host. This section will explain how to do this for basic IPv4 connectivity.</p>
<pre><code class="language-bash">sudo ip tuntap add mode tap user $USER vnet_hdr crosvm_tap
sudo ip addr add 192.168.10.1/24 dev crosvm_tap
sudo ip link set crosvm_tap up
</code></pre>
<p>These commands create a TAP interface named <code>crosvm_tap</code> that is accessible to the current user,
configure the host to use the IP address <code>192.168.10.1</code>, and bring the interface up.</p>
<p>The next step is to make sure that traffic from/to this interface is properly routed:</p>
<pre><code class="language-bash">sudo sysctl net.ipv4.ip_forward=1
# Network interface used to connect to the internet.
HOST_DEV=$(ip route get 8.8.8.8 | awk -- '{printf $5}')
sudo iptables -t nat -A POSTROUTING -o &quot;${HOST_DEV}&quot; -j MASQUERADE
sudo iptables -A FORWARD -i &quot;${HOST_DEV}&quot; -o crosvm_tap -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i crosvm_tap -o &quot;${HOST_DEV}&quot; -j ACCEPT
</code></pre>
<p>The interface is now configured and can be used by crosvm:</p>
<pre><code class="language-bash">crosvm run \
  ...
  --tap-name crosvm_tap \
  ...
</code></pre>
<p>Provided the guest kernel had support for <code>VIRTIO_NET</code>, the network device should be visible and
configurable from the guest:</p>
<pre><code class="language-bash"># Replace with the actual network interface name of the guest
# (use &quot;ip addr&quot; to list the interfaces)
GUEST_DEV=enp0s5
sudo ip addr add 192.168.10.2/24 dev &quot;${GUEST_DEV}&quot;
sudo ip link set &quot;${GUEST_DEV}&quot; up
sudo ip route add default via 192.168.10.1
# &quot;8.8.8.8&quot; is chosen arbitrarily as a default, please replace with your local (or preferred global)
# DNS provider, which should be visible in `/etc/resolv.conf` on the host.
echo &quot;nameserver 8.8.8.8&quot; | sudo tee /etc/resolv.conf
</code></pre>
<p>These commands assign IP address <code>192.168.10.2</code> to the guest, activate the interface, and route
all network traffic to the host. The last line also ensures DNS will work.</p>
<p>Please refer to your distribution's documentation for instructions on how to make these settings
persistent for the host and guest if desired.</p>
<h2 id="control-socket"><a class="header" href="#control-socket">Control Socket</a></h2>
<p>If the control socket was enabled with <code>-s</code>, the main process can be controlled
while crosvm is running. To tell crosvm to stop and exit, for example:</p>
<blockquote>
<p><strong>NOTE:</strong> If the socket path given is for a directory, a socket name
underneath that path will be generated based on crosvm's PID.</p>
</blockquote>
<pre><code class="language-bash">$ crosvm run -s /run/crosvm.sock ${USUAL_CROSVM_ARGS}
    &lt;in another shell&gt;
$ crosvm stop /run/crosvm.sock
</code></pre>
<blockquote>
<p><strong>WARNING:</strong> The guest OS will not be notified or gracefully shutdown.</p>
</blockquote>
<p>This will cause the original crosvm process to exit in an orderly fashion,
allowing it to clean up any OS resources that might have stuck around if crosvm
were terminated early.</p>
<h2 id="multiprocess-mode"><a class="header" href="#multiprocess-mode">Multiprocess Mode</a></h2>
<p>By default crosvm runs in multiprocess mode. Each device that supports running
inside of a sandbox will run in a jailed child process of crosvm. The
appropriate minijail seccomp policy files must be present either in
<code>/usr/share/policy/crosvm</code> or in the path specified by the
<code>--seccomp-policy-dir</code> argument. The sandbox can be disabled for testing with
the <code>--disable-sandbox</code> option.</p>
<h2 id="virtio-wayland"><a class="header" href="#virtio-wayland">Virtio Wayland</a></h2>
<p>Virtio Wayland support requires special support on the part of the guest and as
such is unlikely to work out of the box unless you are using a Chrome OS kernel
along with a <code>termina</code> rootfs.</p>
<p>To use it, ensure that the <code>XDG_RUNTIME_DIR</code> enviroment variable is set and that
the path <code>$XDG_RUNTIME_DIR/wayland-0</code> points to the socket of the Wayland
compositor you would like the guest to use.</p>
<h2 id="gdb-support"><a class="header" href="#gdb-support">GDB Support</a></h2>
<p>crosvm supports <a href="https://sourceware.org/gdb/onlinedocs/gdb/Remote-Protocol.html">GDB Remote Serial Protocol</a> to allow developers to debug guest
kernel via GDB.</p>
<p>You can enable the feature by <code>--gdb</code> flag:</p>
<pre><code class="language-sh"># Use uncompressed vmlinux
$ crosvm run --gdb &lt;port&gt; ${USUAL_CROSVM_ARGS} vmlinux
</code></pre>
<p>Then, you can start GDB in another shell.</p>
<pre><code class="language-sh">$ gdb vmlinux
(gdb) target remote :&lt;port&gt;
(gdb) hbreak start_kernel
(gdb) c
&lt;start booting in the other shell&gt;
</code></pre>
<p>For general techniques for debugging the Linux kernel via GDB, see this
<a href="https://www.kernel.org/doc/html/latest/dev-tools/gdb-kernel-debugging.html">kernel documentation</a>.</p>
<h2 id="defaults"><a class="header" href="#defaults">Defaults</a></h2>
<p>The following are crosvm's default arguments and how to override them.</p>
<ul>
<li>256MB of memory (set with <code>-m</code>)</li>
<li>1 virtual CPU (set with <code>-c</code>)</li>
<li>no block devices (set with <code>-r</code>, <code>-d</code>, or <code>--rwdisk</code>)</li>
<li>no network (set with <code>--host_ip</code>, <code>--netmask</code>, and <code>--mac</code>)</li>
<li>virtio wayland support if <code>XDG_RUNTIME_DIR</code> enviroment variable is set
(disable with <code>--no-wl</code>)</li>
<li>only the kernel arguments necessary to run with the supported devices (add
more with <code>-p</code>)</li>
<li>run in multiprocess mode (run in single process mode with
<code>--disable-sandbox</code>)</li>
<li>no control socket (set with <code>-s</code>)</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../running_crosvm/basic_usage.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../running_crosvm/requirements.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../running_crosvm/basic_usage.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../running_crosvm/requirements.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>
    </body>
</html>
